{% extends "accounting/base.html" %}

{% load staticfiles %}

{% block content %}

    </br>
    <ul class="nav nav-tabs">
        <li><a href={% url 'accounting:dashboard' pk=current.pk %}>Dashboard</a></li>
        <li class="active"><a href={% url 'accounting:contracts' pk=current.pk %}>Contracts</a></li>
        <li><a href={% url 'accounting:expenses' pk=current.pk month=current_month.pk %}>Expenses</a></li>
        <li><a href={% url 'accounting:personnel' pk=current.pk %}>Personnel</a></li>
        <li><a href="#">Prospects</a></li>
    </ul>

    <div class="row">
        <div class="col-md-12">

        {% if contract_invoices %}
            {% for contract_invoice in contract_invoices %}

            <div class="panel-heading" role="tab" id="headingOne">
                <h4 class="panel-title">
                    <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse{{contract_invoice.contract.pk}}" aria-expanded="true" aria-controls="collapse{{contract_invoice.contract.pk}}">
                        <h4 class="lead'">#{{ contract_invoice.contract.contract_number }}: {{ contract_invoice.contract.organization_name }} - {{contract_invoice.contract.contract_state }}</h4><hr>
                    </a>
                </h4>
            </div>

            <div id="collapse{{contract_invoice.contract.pk}}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading{{contract_invoice.contract.pk}}">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-3">
                            <p>Organization Name: </p>
                            <p>Start Date: </p>
                            <p>Total Amount: </p>
                            <p>Contract State: </p>
                            <p>Contract Type: </p>
                        </div>

                        <div class="col-md-5">
                            <p>{{contract_invoice.contract.organization_name}}</p>
                            <p>{{contract_invoice.contract.start_date}}</p>
                            <p>{{contract_invoice.contract.amount }}</p>
                            <p>{{contract_invoice.contract.contract_state }}</p>
                            <p>{{contract_invoice.contract.contract_type }}</p>
                        </div>
                        <div class="col-md-4">
                            <h4>
                                <a class="btn btn-primary" href={% url 'accounting:update_contract' pk=current.pk contract=contract_invoice.contract.pk %}>Update</a>
                                <a class="btn btn-primary" href={% url 'accounting:delete_contract' pk=current.pk contract=contract_invoice.contract.pk %}>Delete</a>
                            </h4>
                        </div>
                    </div>
                    <div class="row">
                            {% if contract_invoice.invoices %}

                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Invoice Date: </th>
                                        <th>Status: </th>
                                        <th>Amount: </th>
                                        <th>Update/Delete</th>
                                    </tr>
                                </thead>
                            <tbody>
                                {% for invoice in contract_invoice.invoices %}
                                <tr>
                                    <th scope="row">{{ invoice.number }}</th>
                                        <td>{{ invoice.date }}</td>
                                        <td>{{ invoice.transation_state }}</td>
                                        <td>{{ invoice.income.predicted_amount }}</td>
                                        <td>
                                            <a class="btn btn-primary" href={% url 'accounting:udpate_invoice' pk=current.pk contract=contract_invoice.contract.pk invoice=invoice.pk %}>Update</a>
                                            <a class="btn btn-primary" href={% url 'accounting:delete_invoice' pk=current.pk contract=contract_invoice.contract.pk invoice=invoice.pk %}>Delete</a>
                                        </td>
                                </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                            {% else %}
                        <div class="col-md-12">
                                <p>No invoices for this contract.</p>
                        </div>
                            {% endif %}
                        <div class="col-md-12">
                            <a class="btn btn-primary" href={% url 'accounting:create_invoice' pk=current.pk contract=contract_invoice.contract.pk %}>Create Invoice</a>
                        </div>
                    </div>
                </div>
            </div>

            {% endfor %}
        {% else %}
            <h4>No contracts for this business unit.</h4>
        {% endif %}
            <a class="btn btn-primary" href={% url 'accounting:create_contract' pk=current.pk %}>Create Contract</a>
        </div>
    </div>
{% endblock %}